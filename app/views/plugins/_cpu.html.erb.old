<% index = 0 %>
<% @plugin.chart_data[:chart_data].each_pair do |cpu, values| %> 
<% index += 1 %>
        <script type="text/javascript">
            var chart;

  	    var chartData<%=index%> = <%= values.to_json.html_safe %>;
							

            AmCharts.ready(function () {
                // SERIAL CHART
                chart = new AmCharts.AmSerialChart();
                chart.pathToImages = "/assets/amcharts/";
		chart.Type
                chart.zoomOutButton = {
                    backgroundColor: "#000000",
                    backgroundAlpha: 0.15
                };
                chart.dataProvider = chartData<%=index%>;
                chart.categoryField = "year";

                chart.addTitle("<%= cpu%> usage", 15);

                // AXES
                // Category
                var categoryAxis = chart.categoryAxis;
                categoryAxis.parseDates = true; // in order char to understand dates, we should set parseDates to true
                categoryAxis.minPeriod = "ss"; // as we have data with minute interval, we have to set "mm" here.			 
                categoryAxis.gridAlpha = 0.07;
                categoryAxis.axisColor = "#DADADA";
                categoryAxis.startOnAxis = true;

                // Value
                var valueAxis = new AmCharts.ValueAxis();
                valueAxis.title = "percent"; // this line makes the chart "stacked"
                valueAxis.stackType = "100%";
                valueAxis.gridAlpha = 0.07;
                chart.addValueAxis(valueAxis);

                // GRAPHS
                // first graph
                var graph = new AmCharts.AmGraph();
                graph.type = "line"; // it's simple line graph
                graph.title = "System";
                graph.valueField = "system";
                graph.balloonText = "[[value]] ([[Percents]]%)";
                graph.lineAlpha = 0;
                graph.fillAlphas = 0.6; // setting fillAlphas to > 0 value makes it area graph 
                chart.addGraph(graph);

                // second graph
                var graph = new AmCharts.AmGraph();
                graph.type = "line";
                graph.title = "User";
                graph.valueField = "user";
                graph.balloonText = "[[value]] ([[percents]]%)";
                graph.lineAlpha = 0;
                graph.fillAlphas = 0.6;
                chart.addGraph(graph);

                // third graph
                var graph = new AmCharts.AmGraph();
                graph.type = "line";
                graph.title = "Nice";
                graph.valueField = "nice";
                graph.balloonText = "[[value]] ([[percents]]%)";
                graph.lineAlpha = 0;
                graph.fillAlphas = 0.6;
                chart.addGraph(graph);

                // 4th graph
                var graph = new AmCharts.AmGraph();
                graph.type = "line";
                graph.title = "Idle";
                graph.valueField = "idle";
                graph.balloonText = "[[value]] ([[percents]]%)";
                graph.lineAlpha = 0;
                graph.fillAlphas = 0.6;
                chart.addGraph(graph);

		//SCROLLBAR
                var chartScrollbar = new AmCharts.ChartScrollbar();
                chartScrollbar.graph = graph;
                chartScrollbar.scrollbarHeight = 40;
                chartScrollbar.color = "#FFFFFF";
                chartScrollbar.graphType = "step";
                chartScrollbar.autoGridCount = true;
                chart.addChartScrollbar(chartScrollbar);

                // WRITE
                // LEGEND
                var legend = new AmCharts.AmLegend();
                legend.align = "center";
                chart.addLegend(legend);


                // CURSOR
                var chartCursor = new AmCharts.ChartCursor();
                chartCursor.cursorPosition = "mouse";
                chartCursor.categoryBalloonDateFormat = "YYYY:MM:DD, HH:NN:SS";
                chartCursor.zoomable = false; // as the chart displayes not too many values, we disabled zooming
                chartCursor.cursorAlpha = 0;
                chart.addChartCursor(chartCursor);

                // WRITE
                chart.write("chartdiv_<%=index%>");
            });
        </script>
    
        <div id="chartdiv_<%=index%>" style="width:100%; height:400px;"></div>
<% end %>
